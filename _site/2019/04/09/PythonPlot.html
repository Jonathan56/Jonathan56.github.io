<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Python Graph snippets</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/blog">&lArr; Jonathan&#39;s blog</a>
  </h1>
</header>
<div class="content post">
  <h1 class="post-title">Python Graph snippets</h1>
  <div class="post-date">
    <time>09 Apr 2019</time>
  </div>
  <p>Plotly / Cufflinks snippets, for quick plots in Python.</p>

<!--more-->
<!-- <head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head> -->

<ul>
  <li><a href="#bar-graph">Bar graph</a></li>
  <li><a href="#line-graph">Line graph</a></li>
  <li><a href="#from-layout">From Layout</a></li>
</ul>

<p>The objective of this post is to provide quick notes and how to for common graphs. Snippets must be short, and customisable if needed. Plotly offer dynamic plots easily exportable and completely parametrised from a “simple” key:value format (which is quite nice compared to matplotlib cryptic functions). Cufflinks and Express are convenient to reduce the lengthy key:value format. One of the cons with offline cufflinks/plotly is the size of your Notebooks instantly bumping to about 3.3MB.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import Cufflinks offline
</span><span class="kn">import</span> <span class="nn">cufflinks</span> <span class="k">as</span> <span class="n">cf</span>
<span class="n">cf</span><span class="p">.</span><span class="n">set_config_file</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="s">'white'</span><span class="p">)</span>
<span class="n">cf</span><span class="p">.</span><span class="n">go_offline</span><span class="p">()</span>

<span class="c1"># Convenient function to display dataframe
</span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="k">def</span> <span class="nf">display_n</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pandas</span><span class="p">.</span><span class="n">option_context</span><span class="p">(</span><span class="s">'display.max_rows'</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<p>Before getting started, here is a convinient list of Plotly’s default colors :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'#1f77b4', rgba(55, 128, 191, 1.0) // muted blue
'#ff7f0e', rgba(255, 127, 14, 1.0) // safety orange
'#2ca02c', rgba(44, 160, 44, 1.0) // cooked asparagus green
'#d62728', rgba(214, 39, 40, 1.0) // brick red
'#9467bd', rgba(148, 103, 189, 1.0) // muted purple
'#8c564b', rgba(140, 86, 75, 1.0) // chestnut brown
'#e377c2', rgba(227, 119, 194, 1.0) // raspberry yogurt pink
'#7f7f7f', rgba(127, 127, 127, 1.0) // middle gray
'#bcbd22', rgba(188, 189, 34, 1.0) // curry yellow-green
'#17becf' rgba(23, 190, 207, 1.0)  // blue-teal
</code></pre></div></div>

<p>Cufflinks also comes with a few utility functions for colors (<a href="https://github.com/santosjorge/cufflinks/blob/master/Cufflinks%20Tutorial%20-%20Colors.ipynb">tutorial</a>).</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cf</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">cnames</span>
<span class="n">cf</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">scales</span><span class="p">()</span>
<span class="n">cf</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">color_range</span><span class="p">(</span><span class="s">'orange'</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="bar-graph">Bar graph</h1>
<p>This first example includes selecting data and normalising it, to prevent scale issues. Note that the Dataframe is sorted before plotting to increase readability.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Select data
</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">index</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'perfect'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s">'Autoprod_%'</span><span class="p">,</span> <span class="s">'Autoconso_%'</span><span class="p">,</span> <span class="s">'MAE_kW'</span><span class="p">,</span> <span class="s">'MAPE_%'</span><span class="p">]]</span>
<span class="n">display_n</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Normalize and bar graph
</span><span class="n">normalized_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span>
<span class="n">normalized_df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">'Autoprod_%'</span><span class="p">).</span><span class="n">iplot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">yTitle</span><span class="o">=</span><span class="s">'Normalized [unitless]'</span><span class="p">,</span>
    <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">layout_update</span><span class="o">=</span><span class="p">{</span><span class="s">'font'</span><span class="p">:</span> <span class="p">{</span><span class="s">'size'</span><span class="p">:</span> <span class="mi">16</span><span class="p">}})</span>
</code></pre></div></div>
<p><img src="/assets/image/Screenshot%202020-05-04%20at%2017.08.20.png" alt="Screenshot 2020-05-04 at 17.08.20" /></p>

<p>Sometimes it might be more useful to look at the actual data (without normalising it). In this case subplots make sense.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">combinations</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">'Autoprod_%'</span><span class="p">)</span>
 <span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s">'Autoprod_%'</span><span class="p">,</span> <span class="s">'Autoconso_%'</span><span class="p">,</span> <span class="s">'MAPE_%'</span><span class="p">,</span> <span class="s">'MAE_kW'</span><span class="p">]]</span>
 <span class="p">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
        <span class="n">layout_update</span><span class="o">=</span><span class="p">{</span><span class="s">'font'</span><span class="p">:</span> <span class="p">{</span><span class="s">'size'</span><span class="p">:</span> <span class="mi">16</span><span class="p">}}))</span>
</code></pre></div></div>
<p><img src="/assets/image/Screenshot%202020-05-04%20at%2017.18.24.png" alt="Screenshot 2020-05-04 at 17.18.24" /></p>

<h1 id="line-graph">Line graph</h1>
<p>Simple graph to look at various times series.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start</span> <span class="o">=</span> <span class="s">'2014-05-01 00:00:00'</span>
<span class="n">end</span> <span class="o">=</span> <span class="s">'2014-05-31 23:45:00'</span>
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:].</span><span class="n">iplot</span><span class="p">(</span>
  <span class="n">kind</span><span class="o">=</span><span class="s">'scatter'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
  <span class="n">yTitle</span><span class="o">=</span><span class="s">'Agg. power demand [kW]'</span><span class="p">,</span>
  <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
  <span class="n">rangeslider</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
  <span class="n">layout_update</span><span class="o">=</span><span class="p">{</span><span class="s">'font'</span><span class="p">:</span> <span class="p">{</span><span class="s">'size'</span><span class="p">:</span> <span class="mi">16</span><span class="p">}})</span>
</code></pre></div></div>
<p><img src="/assets/image/Screenshot%202020-05-04%20at%2017.41.12.png" alt="Screenshot 2020-05-04 at 17.41.12" /></p>

<p>Similar but sampling a random column, and resampling to avoid large graphs.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span>
<span class="n">start</span> <span class="o">=</span> <span class="s">'2007-01-01 00:00:00'</span>
<span class="n">end</span> <span class="o">=</span> <span class="s">'2007-12-31 23:45:00'</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="n">cols</span><span class="p">].</span><span class="n">resample</span><span class="p">(</span><span class="s">'60T'</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">15</span><span class="o">/</span><span class="mi">60</span><span class="p">).</span><span class="n">iplot</span><span class="p">(</span>
  <span class="n">kind</span><span class="o">=</span><span class="s">'scatter'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
  <span class="n">yTitle</span><span class="o">=</span><span class="s">'Agg. power demand [kW]'</span><span class="p">,</span>
  <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">showlegend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
  <span class="n">rangeslider</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
  <span class="n">layout_update</span><span class="o">=</span><span class="p">{</span><span class="s">'font'</span><span class="p">:</span> <span class="p">{</span><span class="s">'size'</span><span class="p">:</span> <span class="mi">16</span><span class="p">}})</span>
</code></pre></div></div>
<h1 id="from-layout">From layout</h1>
<p>This might be useful to transform quick Cufflinks plots into paper grade plots.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Imports
</span><span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">iplot</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="n">go</span>
<span class="kn">import</span> <span class="nn">cufflinks</span> <span class="k">as</span> <span class="n">cf</span>
<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">cf</span><span class="p">.</span><span class="n">set_config_file</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="s">'white'</span><span class="p">)</span>
<span class="n">cf</span><span class="p">.</span><span class="n">go_offline</span><span class="p">()</span>


<span class="c1"># Layout
</span><span class="n">layout</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s">"font"</span><span class="p">:{</span><span class="s">"size"</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span> <span class="s">"color"</span><span class="p">:</span><span class="s">"rgb(3, 3, 3)"</span><span class="p">},</span>
 <span class="s">"height"</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span>
 <span class="s">"width"</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span>
 <span class="s">"legend"</span><span class="p">:{</span><span class="s">"x"</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s">"y"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">},</span>
 <span class="s">"showlegend"</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
 <span class="s">"margin"</span><span class="p">:{</span><span class="s">"b"</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span><span class="s">"l"</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="s">"r"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="s">"t"</span><span class="p">:</span><span class="mi">70</span><span class="p">},</span>
 <span class="s">"title"</span><span class="p">:{</span><span class="s">"font"</span><span class="p">:{</span><span class="s">"color"</span><span class="p">:</span><span class="s">"#4D5663"</span><span class="p">}},</span>
 <span class="s">"xaxis"</span><span class="p">:{</span>
   <span class="s">"gridcolor"</span><span class="p">:</span><span class="s">"#E1E5ED"</span><span class="p">,</span>
   <span class="s">"showgrid"</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
   <span class="s">"tickfont"</span><span class="p">:{</span><span class="s">"color"</span><span class="p">:</span><span class="s">"rgb(0, 0, 0)"</span><span class="p">},</span>
   <span class="s">"title"</span><span class="p">:{</span>
     <span class="s">"font"</span><span class="p">:{</span><span class="s">"color"</span><span class="p">:</span><span class="s">"rgb(0, 0, 0)"</span><span class="p">,</span><span class="s">"size"</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span>
     <span class="s">"text"</span><span class="p">:</span><span class="s">"Community size"</span><span class="p">},</span>
   <span class="s">"zerolinecolor"</span><span class="p">:</span><span class="s">"rgb(0, 0, 0)"</span><span class="p">,</span>
   <span class="s">"type"</span><span class="p">:</span><span class="s">"linear"</span><span class="p">,</span>
   <span class="s">"autorange"</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
   <span class="s">"zerolinewidth"</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
 <span class="s">"yaxis"</span><span class="p">:{</span>
   <span class="s">"gridcolor"</span><span class="p">:</span><span class="s">"#E1E5ED"</span><span class="p">,</span>
   <span class="s">"showgrid"</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
   <span class="s">"tickfont"</span><span class="p">:{</span><span class="s">"color"</span><span class="p">:</span><span class="s">"rgb(0, 0, 0)"</span><span class="p">},</span>
   <span class="s">"title"</span><span class="p">:{</span>
     <span class="s">"font"</span><span class="p">:{</span><span class="s">"color"</span><span class="p">:</span><span class="s">"rgb(0, 0, 0)"</span><span class="p">,</span><span class="s">"size"</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span>
     <span class="s">"text"</span><span class="p">:</span><span class="s">"MAPE [%]"</span><span class="p">},</span>
   <span class="s">"zerolinecolor"</span><span class="p">:</span><span class="s">"rgb(0, 0, 0)"</span><span class="p">,</span>
   <span class="s">"type"</span><span class="p">:</span><span class="s">"linear"</span><span class="p">,</span>
   <span class="s">"autorange"</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
   <span class="s">"zerolinewidth"</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
 <span class="p">}</span>

 <span class="c1"># Custom data look
</span> <span class="n">symbol</span> <span class="o">=</span> <span class="p">[</span><span class="s">'diamond-open'</span><span class="p">,</span> <span class="s">'star'</span><span class="p">,</span>
           <span class="s">'cross-thin-open'</span><span class="p">,</span> <span class="s">'x-thin-open'</span><span class="p">,</span>
           <span class="s">'square-open'</span><span class="p">,</span> <span class="s">'circle-open'</span><span class="p">]</span>
 <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s">'rgba(255, 153, 51, 0.7)'</span><span class="p">,</span>
           <span class="s">'rgba(55, 128, 191, 0.7)'</span><span class="p">,</span>
           <span class="s">'rgba(50, 171, 96, 0.7)'</span><span class="p">,</span>
           <span class="s">'rgba(128, 0, 128, 0.7)'</span><span class="p">,</span>
           <span class="s">'rgba(0, 128, 128, 0.7)'</span><span class="p">,</span>
           <span class="s">'rgba(219, 169, 17, 0.7)'</span><span class="p">]</span>

 <span class="c1"># Plot
</span> <span class="n">myfig</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iplot</span><span class="p">(</span>
     <span class="n">mode</span><span class="o">=</span><span class="s">'lines+markers'</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
     <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
     <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

 <span class="c1"># Custom fig
</span> <span class="n">myfig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">'marker'</span><span class="p">][</span><span class="s">'size'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

 <span class="c1"># Visualize and save as PDF
</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">myfig</span><span class="p">)</span>
 <span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
 <span class="n">fig</span><span class="p">.</span><span class="n">write_image</span><span class="p">(</span><span class="s">"mape.pdf"</span><span class="p">)</span>
</code></pre></div></div>
<p>It’s also possible to <code class="language-plaintext highlighter-rouge">myfig.write_json('my_graph.plotly')</code> just with Cufflinks, and then edit within the JupyterLab plotly extension (this might be a good way to come up with “layout” in the first place).</p>

</div>

  </div>
</body>
</html>
